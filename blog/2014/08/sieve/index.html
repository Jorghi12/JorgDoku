<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Prime Sieves and Python Data Structures - LightQuanta</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="http://sanghan.me/img/hv.png" rel="icon">

<link rel="canonical" href="http://sanghan.me/blog/2014/08/sieve/">

        <meta name="author" content="Sang Han" />
        <meta name="keywords" content="Python,Prime Numbers,Sieve,Eratosthenes,Numpy,Project Euler,Algorithms,Data Structures" />
        <meta name="description" content="Recently, I’ve been working through Project Euler problems in order to improve my core programming skills. One of those recurring problems requires an efficiently calculating and testing for prime numbers. The first algorithm that comes to mind is The Sieve of Eratosthenes. The Sieve, is one of many prime sieves, and is a simple yet time efficient algorithm for finding all the primes below a certain limit. It can be shown to have a time complexity of O(nloglogn). The Algorithm Make a table one entry for every number 2 ≤ n ≤ limit Starting at 2, cross out ..." />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://sanghan.me/theme/css/bootstrap.paper.min.css" type="text/css"/>
    <link href="http://sanghan.me/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://sanghan.me/theme/css/pygments/solarizedlight.css" rel="stylesheet">
        <link href="http://sanghan.me/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://sanghan.me/theme/css/style.css" type="text/css"/>
        <link href="http://sanghan.me/static/css/site.css" rel="stylesheet">

        <link href="http://sanghan.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="LightQuanta ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://sanghan.me/" class="navbar-brand">

<i class="fa fa-flask pull-center fa-border"></i>
                LightQuanta
            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">

                         <li>
                             <a href="http://sanghan.me/pages/about.html">
                             <i class="fa fa-beer"></i>
                             <span class="icon-label">About&nbsp;Me</span>
                             </a>
                         </li>
                         <li>
                             <a href="http://sanghan.me/pages/projects.html">
                             <i class="fa fa-code"></i>
                             <span class="icon-label">Projects</span>
                             </a>
                         </li>
                         <li>
                             <a href="http://sanghan.me/pages/skills.html">
                             <i class="fa fa-graduation-cap"></i>
                             <span class="icon-label">Skills</span>
                             </a>
                         </li>
                         <li>
                             <a href="http://sanghan.me/pages/tools.html">
                             <i class="fa fa-wrench"></i>
                             <span class="icon-label">Tools</span>
                             </a>
                         </li>

                <!--Dropdown Categories-->
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Categories<b class="caret"></b></a>
                    <ul class="dropdown-menu" role="menu">
                        <li >
                        <a href="http://sanghan.me/category/articles.html">Articles</a></li>
                        <li  class="active" >
                        <a href="http://sanghan.me/category/programming.html">Programming</a></li>
                        <li >
                        <a href="http://sanghan.me/category/quotes.html">Quotes</a></li>
                        <li >
                        <a href="http://sanghan.me/category/tumblr.html">Tumblr</a></li>
                    </ul>
                    </li>


<!-- Disabled
<ul class="nav navbar-nav navbar-right">
    <li><a href="http://sanghan.me/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
</ul>
-->

        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->


<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="http://sanghan.me" title="LightQuanta"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="http://sanghan.me/category/programming.html" title="Programming">Programming</a></li>
                <li class="active">Prime Sieves and Python Data&nbsp;Structures</li>
            </ol>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://sanghan.me/blog/2014/08/sieve/"
                       rel="bookmark"
                       title="Permalink to Prime Sieves and Python Data Structures">
                        Prime Sieves and Python Data&nbsp;Structures
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-primary">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-08-29T00:00:00-07:00"> Fri, 29 Aug 2014</time>
    </span>

        <span class="label label-success">Category</span>
        <a href="http://sanghan.me/category/programming.html">Programming</a>


<span class="label label-info">Tags</span>
	<a href="http://sanghan.me/tag/python.html">Python</a>
        /
	<a href="http://sanghan.me/tag/prime-numbers.html">Prime Numbers</a>
        /
	<a href="http://sanghan.me/tag/sieve.html">Sieve</a>
        /
	<a href="http://sanghan.me/tag/eratosthenes.html">Eratosthenes</a>
        /
	<a href="http://sanghan.me/tag/numpy.html">Numpy</a>
        /
	<a href="http://sanghan.me/tag/project-euler.html">Project Euler</a>
        /
	<a href="http://sanghan.me/tag/algorithms.html">Algorithms</a>
        /
	<a href="http://sanghan.me/tag/data-structures.html">Data Structures</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Recently, I’ve been working through <a class="reference external" href="https://projecteuler.net">Project Euler</a> problems
in order to improve my core programming&nbsp;skills.</p>
<p>One of those recurring problems requires an
efficiently calculating and testing for prime numbers. The first
algorithm that comes to mind is <a class="reference external" href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">The Sieve of Eratosthenes</a>.
The Sieve, is one of many prime sieves, and is a simple yet time efficient algorithm
for finding all the primes below a certain limit. It can be shown to
have a time complexity of <span class="formula"><span class="scriptfont">O</span>(<i>n</i>loglog<i>n</i>)</span>.</p>
<div class="section" id="the-algorithm">
<h2>The&nbsp;Algorithm</h2>
<ol class="arabic simple">
<li>Make a table one entry for every number <span class="formula">2 ≤ <i>n</i> ≤ <i>limit</i></span></li>
<li>Starting at 2, cross out all multiples of 2, not counting 2&nbsp;itself.</li>
<li>Move up to the next number that hasn&#8217;t been crossed&nbsp;out</li>
<li>Repeat Step 2-3 up till <span class="formula"><span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root"><i>n</i></span><span class="ignored">)</span></span></span></li>
</ol>
<p>Visually we can depict each loop removing values from the list
of real numbers until all that is left are the&nbsp;primes.</p>
<p><img alt="sieve" src="http://sanghan.me/img/sieve.jpg" /></p>
<blockquote class="pull-quote">
Unfortunately, this solution starts to become less
viable for larger problem sizes.</blockquote>
<p>Since it requires a table of every
number to the last integer in memory, the space complexity of sieves generally
grows in the order of <span class="formula"><span class="scriptfont">O</span>(<i>n</i>)</span>. In order to deal with memory issues
there is a set of Sieve algorithms called <code>segmented sieves</code> which distribute
the problem into smaller&nbsp;subsets.</p>
<blockquote class="pull-quote">
Here&#8217;s how it would look in Python.</blockquote>
</div>
<div class="section" id="the-code">
<h2>The&nbsp;Code</h2>
<blockquote class="pull-quote">
I&#8217;ve written out the function definition using <code>type annotations</code>,
which make it easier to understand the arguments that a
function can take and what types they can return.
The one downside of using annotations is this language construct is
not backward compatble with Python 2.</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="c"># Type Annotation Prototype</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span></pre></div>
<div class="section" id="sieve">
<h3>Sieve</h3>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="line-2">    <span class="sd">&quot;&quot;&quot;Sieve away and only primes are left.&quot;&quot;&quot;</span>
</span><span id="line-3">    <span class="n">primes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">True</span><span class="p">]</span>
</span><span id="line-4">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="line-5">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span><span id="line-6">            <span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</span><span id="line-7">    <span class="k">return</span> <span class="p">[</span><span class="n">prime</span> <span class="k">for</span> <span class="n">prime</span><span class="p">,</span> <span class="n">checked</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="k">if</span> <span class="n">checked</span><span class="p">]</span>
</span></pre></div>
<p>It&#8217;s important to notice we implement <code>lists</code> as the main data structure.
Remember although the algorithm requires an in memory table,
we have the freedom to construct it using
whatever tools the runtime affords. Here is an example of another sieve
but with it&#8217;s guts swapped with <code>sets</code>.</p>
</div>
<div class="section" id="sets-unordered-collections">
<h3>Sets: Unordered&nbsp;Collections</h3>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">set_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
</span><span id="line-2">    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-3"><span class="sd">    Sets are mutable, unordered collections which are useful</span>
</span><span id="line-4"><span class="sd">    for quick membership testing and math operations.</span>
</span><span id="line-5"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-6">    <span class="n">primes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="line-7">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="line-8">        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
</span><span id="line-9">            <span class="n">primes</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="line-10">    <span class="k">return</span> <span class="n">primes</span>
</span></pre></div>
<p>In this example, the primary difference with using <code>sets</code> and <code>lists</code>, is the
lack of a list-comprehension for composing the function return value. As well, the
second for-loop is substituted with one <code>-=</code>, assignment operator, which for
sets has been operator overloaded with a <code>difference update</code> method or
the <code>set compliment</code> <span class="formula">∀{<i>x</i>|<span class="text"> x </span> ∈ <span class="text">A : x </span>∉<span class="text"> B</span>}</span></p>
<p>Utilizing sets provides us a cleaner syntax for algorithms involving math.
In this example, we are first creating
a universal set, and iteriatively deleting it&#8217;s factors. It would
also be correct to create a null set and iteratively collect all factors first.
At the end, once all factors have been collected, we then perform removal
from the universal set. This route optimizes membership testing to occur
primarily with insertion due to insertion operations performing faster than&nbsp;deletions.</p>
</div>
<div class="section" id="insertion-sets">
<h3>Insertion&nbsp;Sets:</h3>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">set_insertion_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
</span><span id="line-2">    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-3"><span class="sd">    Performing insertion over deletion utilizing</span>
</span><span id="line-4"><span class="sd">    constant time nature of hashable collections.</span>
</span><span id="line-5"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-6">    <span class="n">factors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="line-7">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="line-8">        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
</span><span id="line-9">            <span class="n">factors</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="line-10">    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">factors</span>
</span></pre></div>
<p>While fundamentally the choice data
structure is orthoganal to program correctness,
it&#8217;s important for real runtime performance to use the best
tool to fit the job. Lists and sets are great general purpose data-structure,
and is likely the first tool to reach for in the&nbsp;arsenal.</p>
<p>However, <a class="reference external" href="http://en.wiktionary.org/wiki/if_all_you_have_is_a_hammer,_everything_looks_like_a_nail">Maslow</a> tells&nbsp;us</p>
<blockquote class="pull-quote">
<p><em>&quot;If the only tool you have is a hammer everything looks like a&nbsp;nail.&quot;</em></p>
<p>The Psychology of Science&nbsp;(1964)</p>
</blockquote>
<p>In Python, the generality of lists and sets are
probably also their downside, since they are useful for so many&nbsp;things.</p>
<p>So what is the optimal data structure to perform these&nbsp;calculation?</p>
</div>
<div class="section" id="numpy">
<h3>Numpy</h3>
<blockquote class="pull-quote">
Enter: The Array</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span id="line-2">
</span><span id="line-3"><span class="k">def</span> <span class="nf">np_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="line-4">    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-5"><span class="sd">    Sieve with it&#39;s guts swapped with numpy</span>
</span><span id="line-6"><span class="sd">    ndarray</span>
</span><span id="line-7"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-8">    <span class="n">primes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span><span id="line-9">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">):</span>
</span><span id="line-10">        <span class="k">if</span> <span class="n">primes</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="line-11">            <span class="n">primes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">::</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</span><span id="line-12">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">primes</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
</span></pre></div>
<p>Numpy is a third party numerical library, containing array based data structures
and vectorized methods for utilizing them. Here we operate on numpy&#8217;s <code>n-dimmensional array</code>.
Numpy arrays are fixed strides of memory with statically typed elements.
The downside to statically typed elements within a dynamically language is
affording many of the niceties that Python provides. Everything inside a
numpy array must be homogenous, and we cannot perform the same types of
operations on <code>bools</code> as we would on <code>ints</code> or <code>floats</code>.
However, the benefit is random access to each array element based on
it&#8217;s position in memory without&nbsp;traversal.</p>
<p>In our example we are filling up the array with <code>8-bit bools</code> all set
to <code>True</code>, or <code>1</code> in this case. We then iterate through an array
of <code>32-bit unsigned integers</code>, and sieve the multiples set as <code>False</code>, or <code>0</code>.
Finally, we return all non-zero from the boolean array from 2 to the end which are
still <code>True</code>.</p>
</div>
</div>
<div class="section" id="testing-for-primality">
<h2>Testing for&nbsp;Primality</h2>
<p>So now that we&#8217;ve written the sieve in a bunch of different ways. How do we know that
each way is indeed&nbsp;correct.</p>
<p>The most obvious way to figure if a number&#8217;s prime, is to try dividing the number
by all the numbers between <span class="formula">2 ≤ <i>x</i> ≤ <i>n</i> − 1</span>.</p>
<blockquote class="pull-quote">
One optimization would be
to only factor these numbers up to <span class="formula">2 ≤ <i>x</i> ≤ <span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root"><i>n</i></span><span class="ignored">)</span></span></span>.</blockquote>
<p>This is possible because if <span class="formula"><i>n</i> = <i>p</i> × <i>q</i></span>, either <span class="formula"><i>p</i></span> or <span class="formula"><i>q</i></span>
must be less than or equal to <span class="formula"><span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root"><i>n</i></span><span class="ignored">)</span></span></span>, or their product is greater
than n. If checking possible factors up to <span class="formula"><span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root"><i>n</i></span><span class="ignored">)</span></span></span>,
we know that for any <span class="formula"><i>p</i></span> in <span class="formula"><i>p</i> × <i>q</i></span> cannot be less than
<span class="formula"><i>q</i></span>. This reduces the run time for each factorization
down to <span class="formula"><span class="scriptfont">O</span>(<span class="sqrt"><span class="radical">√</span><span class="ignored">(</span><span class="root"><i>n</i></span><span class="ignored">)</span></span>)</span>.</p>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">all_primes</span><span class="p">(</span><span class="n">primes</span><span class="p">:</span> <span class="nb">iter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="line-2">    <span class="k">for</span> <span class="n">prime</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
</span><span id="line-3">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">prime</span> <span class="o">%</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">prime</span><span class="o">**</span><span class="mf">0.5</span><span class="p">))):</span>
</span><span id="line-4">            <span class="k">return</span> <span class="bp">False</span>
</span><span id="line-5">    <span class="k">return</span> <span class="bp">True</span>
</span></pre></div>
<blockquote class="pull-quote">
Now lets test to see if our sieves can correctly find the first 100 prime numbers</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">np_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">set_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">set_insertion_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
</div>
<div class="section" id="a-timer">
<h2>A&nbsp;Timer</h2>
<p>Now knowing that our implementations are correct, lets see how fast they run.
We will construct a timer taking advantage of what is known as a <code>context manager</code>.
Basically, a context manager allows us to use the <code>with</code> construct
and will perform an operation before and after by overloading the <code>__enter__</code>
and <code>__exit__</code> methods of python object. We can create a context manager
merely by using a decorator from the <code>contextlib</code> module.</p>
<div class="highlight"><pre><span id="line-1"><span class="kn">import</span> <span class="nn">time</span>
</span><span id="line-2"><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
</span><span id="line-3">
</span><span id="line-4"><span class="nd">@contextmanager</span>
</span><span id="line-5"><span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
</span><span id="line-6">    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="line-7">    <span class="k">try</span><span class="p">:</span>
</span><span id="line-8">        <span class="k">yield</span>
</span><span id="line-9">    <span class="k">finally</span><span class="p">:</span>
</span><span id="line-10">        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="line-11">    <span class="k">print</span><span class="p">(</span><span class="s">&#39;{label}: {time:03.3f} sec&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="line-12">        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</span><span id="line-13">    <span class="p">)</span>
</span></pre></div>
<blockquote class="pull-quote">
It&#8217;s also possible to use Python&#8217;s built in <code>timeit</code> module, which can deal
with much more complex and isolated timing instances.</blockquote>
</div>
<div class="section" id="performance-testing">
<h2>Performance&nbsp;Testing</h2>
<blockquote class="pull-quote">
Now lets see how fast our seives can find the first million
digits.</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;sieve&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">sieve</span><span class="p">:</span> <span class="mf">0.454</span> <span class="n">sec</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;set_sieve&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">set_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">set_sieve</span><span class="p">:</span> <span class="mf">0.735</span> <span class="n">sec</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;set_insertion_sieve&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">set_insertion_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">set_factor_sieve</span><span class="p">:</span> <span class="mf">0.587</span> <span class="n">sec</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;numpy&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">np_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">numpy</span><span class="p">:</span> <span class="mf">0.008</span> <span class="n">sec</span>
</span></pre></div>
</div>

            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'sanghan'; // required: replace example with your forum shortname

                    var disqus_identifier = 'sieve';
                var disqus_url = 'http://sanghan.me/blog/2014/08/sieve/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

    </div>

        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://github.com/jjangsangy"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                    <li class="list-group-item"><a href="http://facebook.com/jjangsangy"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
                    <li class="list-group-item"><a href="https://www.linkedin.com/pub/sang-han/40/9a8/323"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
                    <li class="list-group-item"><a href="http://jjangsangy.tumblr.com"><i class="fa fa-tumblr-square fa-lg"></i> Tumblr</a></li>
                    <li class="list-group-item"><a href="http://pinterest.com/jjangsangy"><i class="fa fa-pinterest-square fa-lg"></i> Pinterest</a></li>
                  </ul>
                </li>

                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                    <ul class="list-group" id="recentposts">
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/08/sieve/">
                                Prime Sieves and Python Data&nbsp;Structures
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/06/swift_program_is_swift_except_when_its_not/">
                                Swift Program is Swift, Except When it&#8217;s&nbsp;Not
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/06/pelican_blog/">
                                Pelican: A Blogging Engine Written in&nbsp;Python
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/06/swift_bubble_sort/">
                                Swift: Bubble&nbsp;Sort
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/05/digital_universe/">
                                Digital&nbsp;Universe
                            </a>
                        </li>
                    </ul>
                </li>



    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/jjangsangy">@jjangsangy</a> on GitHub
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 LightQuanta
            &middot; Sang Han         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://sanghan.me/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://sanghan.me/theme/js/bootstrap.min.js"></script>

<!-- Custom site js-->
<script src="http://sanghan.me/static/js/site.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://sanghan.me/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://sanghan.me/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'jjangsangy',
                count: 10,
                skip_forks: true,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://sanghan.me/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sanghan'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-51412306-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
</body>
</html>