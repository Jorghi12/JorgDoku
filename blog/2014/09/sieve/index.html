<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Prime Sieves and Python Data Structures - LightQuanta</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="http://sanghan.me/img/hv.png" rel="icon">

<link rel="canonical" href="http://sanghan.me/blog/2014/09/sieve/">

        <meta name="author" content="Sang Han" />
        <meta name="keywords" content="Python,Prime Numbers,Sieve,Eratosthenes,Numpy,Project Euler,Algorithms,Data Structures" />
        <meta name="description" content="Recently, I’ve been working through Project Euler in order to improve my core programming skills. One of those recurring problems requires efficiently calculating and testing for prime numbers. The first algorithm that comes to mind is The Sieve of Eratosthenes. The Sieve, is one of many prime sieves, and is a simple yet time efficient algorithm for finding all the primes below a certain limit. The Algorithm Make a table one entry for every number $2 \leq n \leq limit$ Starting at 2, cross out all multiples of 2, not counting 2 itself. Move up to the next number ... if (!document.getElementById(&#39;mathjaxscript_pelican_#%@#$@#&#39;)) { var mathjaxscript = document.createElement(&#39;script&#39;); mathjaxscript.id = &#39;mathjaxscript_pelican_#%@#$@#&#39;; mathjaxscript.type = &#39;text/javascript&#39;; mathjaxscript.src = &#39;https:&#39; == document.location.protocol ? &#39;https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&#39; : &#39;http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&#39;; mathjaxscript[(window.opera ? &#34;innerHTML&#34; : &#34;text&#34;)] = &#34;MathJax.Hub.Config({&#34; + &#34; config: [&#39;MMLorHTML.js&#39;],&#34; + &#34; TeX: { extensions: [&#39;AMSmath.js&#39;,&#39;AMSsymbols.js&#39;,&#39;noErrors.js&#39;,&#39;noUndefined.js&#39;], equationNumbers: { autoNumber: &#39;AMS&#39; } },&#34; + &#34; jax: [&#39;input/TeX&#39;,&#39;input/MathML&#39;,&#39;output/HTML-CSS&#39;],&#34; + &#34; extensions: [&#39;tex2jax.js&#39;,&#39;mml2jax.js&#39;,&#39;MathMenu.js&#39;,&#39;MathZoom.js&#39;],&#34; + &#34; displayAlign: &#39;center&#39;,&#34; + &#34; displayIndent: &#39;0em&#39;,&#34; + &#34; showMathMenu: false,&#34; + &#34; tex2jax: { &#34; + &#34; inlineMath: [ [&#39;$&#39;,&#39;$&#39;] ], &#34; + &#34; displayMath: [ [&#39;$$&#39;,&#39;$$&#39;] ],&#34; + &#34; processEscapes: true,&#34; + &#34; preview: &#39;TeX&#39;,&#34; + &#34; }, &#34; + &#34; &#39;HTML-CSS&#39;: { &#34; + &#34; styles: { &#39;.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn&#39;: {color: &#39;inherit ! important&#39;} }&#34; + &#34; } &#34; + &#34;}); &#34;; (document.body || document.getElementsByTagName(&#39;head&#39;)[0]).appendChild(mathjaxscript); }" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://sanghan.me/theme/css/bootstrap.paper.min.css" type="text/css"/>
    <link href="http://sanghan.me/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://sanghan.me/theme/css/pygments/solarizedlight.css" rel="stylesheet">
    <link rel="stylesheet" href="http://sanghan.me/theme/css/style.css" type="text/css"/>
        <link href="http://sanghan.me/static/css/site.css" rel="stylesheet">

        <link href="http://sanghan.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="LightQuanta ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://sanghan.me/" class="navbar-brand">

<i class="fa fa-flask pull-center fa-border"></i>
                LightQuanta
            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">

                         <li>
                             <a href="http://sanghan.me/pages/about.html">
                             <i class="fa fa-beer"></i>
                             <span class="icon-label">About Me</span>
                             </a>
                         </li>
                         <li>
                             <a href="http://sanghan.me/pages/projects.html">
                             <i class="fa fa-code"></i>
                             <span class="icon-label">Projects</span>
                             </a>
                         </li>
                         <li>
                             <a href="http://sanghan.me/pages/skills.html">
                             <i class="fa fa-graduation-cap"></i>
                             <span class="icon-label">Skills</span>
                             </a>
                         </li>
                         <li>
                             <a href="http://sanghan.me/pages/tools.html">
                             <i class="fa fa-wrench"></i>
                             <span class="icon-label">Tools</span>
                             </a>
                         </li>

                <!--Dropdown Categories-->
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Categories<b class="caret"></b></a>
                    <ul class="dropdown-menu" role="menu">
                        <li >
                        <a href="http://sanghan.me/category/articles.html">Articles</a></li>
                        <li  class="active" >
                        <a href="http://sanghan.me/category/programming.html">Programming</a></li>
                        <li >
                        <a href="http://sanghan.me/category/quotes.html">Quotes</a></li>
                        <li >
                        <a href="http://sanghan.me/category/tumblr.html">Tumblr</a></li>
                    </ul>
                    </li>


<!-- Disabled
<ul class="nav navbar-nav navbar-right">
    <li><a href="http://sanghan.me/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
</ul>
-->

        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->


<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="http://sanghan.me" title="LightQuanta"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="http://sanghan.me/category/programming.html" title="Programming">Programming</a></li>
                <li class="active">Prime Sieves and Python Data Structures</li>
            </ol>

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://sanghan.me/blog/2014/09/sieve/"
                       rel="bookmark"
                       title="Permalink to Prime Sieves and Python Data Structures">
                        Prime Sieves and Python Data Structures
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-primary">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-09-08T00:00:00-07:00"> Mon, 08 Sep 2014</time>
    </span>

        <span class="label label-success">Category</span>
        <a href="http://sanghan.me/category/programming.html">Programming</a>


<span class="label label-info">Tags</span>
	<a href="http://sanghan.me/tag/python.html">Python</a>
        /
	<a href="http://sanghan.me/tag/prime-numbers.html">Prime Numbers</a>
        /
	<a href="http://sanghan.me/tag/sieve.html">Sieve</a>
        /
	<a href="http://sanghan.me/tag/eratosthenes.html">Eratosthenes</a>
        /
	<a href="http://sanghan.me/tag/numpy.html">Numpy</a>
        /
	<a href="http://sanghan.me/tag/project-euler.html">Project Euler</a>
        /
	<a href="http://sanghan.me/tag/algorithms.html">Algorithms</a>
        /
	<a href="http://sanghan.me/tag/data-structures.html">Data Structures</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Recently, I’ve been working through <a class="reference external" href="https://projecteuler.net">Project Euler</a> in order to improve my
core programming&nbsp;skills.</p>
<p>One of those recurring problems requires
efficiently calculating and testing for prime numbers. The first
algorithm that comes to mind is <a class="reference external" href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">The Sieve of Eratosthenes</a>.
The Sieve, is one of many prime sieves, and is a simple yet time efficient algorithm
for finding all the primes below a certain&nbsp;limit.</p>
<div class="section" id="the-algorithm">
<h2>The&nbsp;Algorithm</h2>
<ol class="arabic simple">
<li>Make a table one entry for every number <cite><mathjax>$2 \leq n \leq limit$</mathjax></cite></li>
<li>Starting at 2, cross out all multiples of 2, not counting 2&nbsp;itself.</li>
<li>Move up to the next number that hasn&#8217;t been crossed&nbsp;out</li>
<li>Repeat Step 2-3 up till <cite><mathjax>$\sqrt n$</mathjax></cite></li>
</ol>
<blockquote class="pull-quote">
The Sieve of Eratosthenes can be shown to have a time
complexity of <mathjax>$\mathcal{O}(n\log{}\log{n})$</mathjax>.</blockquote>
<p>Visually we can depict each loop removing values from the list
of real numbers until all that is left are the&nbsp;primes.</p>
<p><img alt="sieve" src="http://sanghan.me/img/sieve.jpg" /></p>
<blockquote class="pull-quote">
Unfortunately, this solution starts to become less
viable for larger problem sizes.</blockquote>
<p>Since it requires a table of every
number to the last integer in memory, the space complexity of sieves generally
grows in the order of <cite><mathjax>$\mathcal{O}(n)$</mathjax></cite>. In order to deal with memory issues
there are sieve algorithms called <code>segmented sieves</code> which map and distribute
the problem into smaller sizes and are computed in&nbsp;parallel.</p>
<blockquote class="pull-quote">
Here&#8217;s how a basic sieve would look in Python.</blockquote>
</div>
<div class="section" id="the-code">
<h2>The&nbsp;Code</h2>
<blockquote class="pull-quote">
I&#8217;ve written out the function definition using <code>type annotations</code>,
which explicitly describe the type of arguments a function take and what
types they return. This is a great documentation tool built-in, but only
available for Python 3 and not Python 2.</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="c"># Type Annotation Prototype</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span></pre></div>
<div class="section" id="sieve">
<h3>Sieve</h3>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="line-2">    <span class="sd">&quot;&quot;&quot;Sieve away and only primes are left.&quot;&quot;&quot;</span>
</span><span id="line-3">    <span class="n">primes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">True</span><span class="p">]</span>
</span><span id="line-4">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="line-5">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
</span><span id="line-6">            <span class="n">primes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</span><span id="line-7">    <span class="k">return</span> <span class="p">[</span><span class="n">prime</span> <span class="k">for</span> <span class="n">prime</span><span class="p">,</span> <span class="n">checked</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">primes</span><span class="p">)</span> <span class="k">if</span> <span class="n">checked</span><span class="p">]</span>
</span></pre></div>
<p>It&#8217;s important to notice we implement <code>lists</code> as the main data structure.
Remember although the algorithm requires an in memory table,
we have the freedom to construct it using
whatever tools the runtime affords. Here is an example of another sieve
but with it&#8217;s guts swapped with <code>sets</code>.</p>
</div>
<div class="section" id="sets-unordered-collections">
<h3>Sets: Unordered&nbsp;Collections</h3>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">set_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
</span><span id="line-2">    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-3"><span class="sd">    Sets are mutable, unordered collections which are useful</span>
</span><span id="line-4"><span class="sd">    for quick membership testing and math operations.</span>
</span><span id="line-5"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-6">    <span class="n">primes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="line-7">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="line-8">        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
</span><span id="line-9">            <span class="n">primes</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="line-10">    <span class="k">return</span> <span class="n">primes</span>
</span></pre></div>
<p>In this example, the primary difference with using <code>sets</code> and <code>lists</code>, is the
lack of a list-comprehension for composing the function return value. As well, the
second for-loop is substituted with one <code>-=</code>, binary assignment operator, which for
sets has been overloaded with a <code>difference update</code> method or
the mathematical complement <mathjax>$\forall \{\text{n}|\text{ n }\in \text{A : n }\notin\text{ B}\}$</mathjax></p>
<p>Utilizing sets provides us a cleaner syntax for algorithms involving math.
In this example, we first create a <code>universal set</code>, and iteriatively delete it&#8217;s factors.
It would also be correct to construct a <code>null set</code> and iteratively insert all factors first.
Once all factors have been collected, perform a removal from the universal&nbsp;set.</p>
</div>
<div class="section" id="insertion-sets">
<h3>Insertion&nbsp;Sets:</h3>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">set_insertion_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">:</span>
</span><span id="line-2">    <span class="sd">&quot;&quot;&quot;Performing insertion over deletion&quot;&quot;&quot;</span>
</span><span id="line-3">    <span class="n">factors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="line-4">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
</span><span id="line-5">        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
</span><span id="line-6">            <span class="n">factors</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span id="line-7">    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">factors</span>
</span></pre></div>
</div>
<div class="section" id="algorithmic-analysis">
<h3>Algorithmic&nbsp;Analysis</h3>
<p>The question is, is it really possible characterize runtime without
actually running a single benchmark? For much <a class="reference external" href="http://en.wikipedia.org/wiki/Travelling_salesman_problem">larger programs</a>, it might not be,
but for this isolated case, it&#8217;s possible to make some good&nbsp;predictions.</p>
<p>Both <code>set_sieve</code> and <code>set_insertion_sieve</code> perform similar operations
until the second iterative block. Because set operations are primarily implemeneted as hashes, we can assert that
both set <code>insertion</code> and set <code>deletion</code> are contant-time operations in relation to problem-size
and linear-time operations in relation hash-size. Therefore, it&#8217;s possible that
either of these soltuions could run faster because with each iteration of <code>set_sieve</code>
the hash-size decreases, while <code>set_insertion_sieve</code> hash size&nbsp;increases.</p>
<blockquote class="pull-quote">
But what if we knew the proportion of primes vs non-primes in a series?</blockquote>
</div>
<div class="section" id="prime-number-theorem">
<h3>Prime Number&nbsp;Theorem</h3>
<p>Early intuition would have biased us about the general abundance of primes
and non-primes. But the prime number theorem is a mathematical proof
between the amount of primes and non-primes that exist in the set of real&nbsp;numbers.</p>
<p><mathjax>$$
\large\lim_{x\to \infty} \frac{\pi(x)}{\frac{x}{\ln(x))}} = 1 \tag{def}
$$</mathjax></p>
<p>It&#8217;s basic definition is that as we move across the x-axis of real numbers
<mathjax>$\pi(x)$</mathjax> a function computing number of primes at x, we can expect as
<mathjax>$x\to \infty$</mathjax> that <mathjax>$\pi(x) \to \frac{x}{\ln(x)}$</mathjax>, and the entire
expression approaches&nbsp;1.</p>
<p><mathjax>$$
\large \pi(x) \tag{asymtotic} \thicksim \large \frac{x}{\ln(x))}
$$</mathjax></p>
<p>From the asymptotic expression, we can also express the function for
computing all factors of <mathjax>$n$</mathjax> to then&nbsp;be</p>
<p><mathjax>$$\begin{align}
\large n\left(1 - \frac{1}{\ln(n)}\right) \tag{factors}
\end{align}$$</mathjax></p>
<blockquote class="pull-quote">
We therefore find that our insertion implementation actually runs in the order
of <mathjax>$\frac{1}{\ln(n)}$</mathjax> faster! This shows that <code>set_sieve</code> is indeed
faster, but it might be the smallest optimization possible and fundamentally
converges to the original <code>sieve</code> speed at larger problem sizes.</blockquote>
</div>
<div class="section" id="data-structures">
<h3>Data&nbsp;Structures</h3>
<p>While the choice data
structure is orthoganal to program correctness,
it&#8217;s important for real runtime performance to use the tool
that best fits the&nbsp;job.</p>
<p><a class="reference external" href="http://en.wiktionary.org/wiki/if_all_you_have_is_a_hammer,_everything_looks_like_a_nail">Maslow</a> tells&nbsp;us</p>
<blockquote class="pull-quote">
<p><em>&quot;If the only tool you have is a hammer everything looks like a&nbsp;nail.&quot;</em></p>
<p>The Psychology of Science&nbsp;(1964)</p>
</blockquote>
<p>Lists and sets are great general purpose data-structure,
and is likely the first tool to reach for when presented with a problem.
However, their generality and utility are also likely our
downfall when better suited tools are also&nbsp;available.</p>
<blockquote class="pull-quote">
So what is the most optimal data structure to perform these calculation?</blockquote>
</div>
<div class="section" id="enter-the-array">
<h3>Enter: The&nbsp;Array</h3>
<div class="highlight"><pre><span id="line-1"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span id="line-2">
</span><span id="line-3"><span class="k">def</span> <span class="nf">np_sieve</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="line-4">    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="line-5"><span class="sd">    Sieve with it&#39;s guts swapped with numpy</span>
</span><span id="line-6"><span class="sd">    ndarray</span>
</span><span id="line-7"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="line-8">    <span class="n">primes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
</span><span id="line-9">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">**</span><span class="mf">0.5</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">):</span>
</span><span id="line-10">        <span class="k">if</span> <span class="n">primes</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="line-11">            <span class="n">primes</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">::</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</span><span id="line-12">    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">primes</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
</span></pre></div>
<p>Numpy is a third party library containing array based data structures
and fast vectorizable methods for numerical operations.
Here we operate on numpy&#8217;s <code>n-dimmensional arrays</code>
which allocate fixed strides of memory containing <code>statically typed</code> elements.
The downside of implementing a statically typed subset within a dynamically typed
language is to forego many of the niceties python has to offer.
However, the main benefit is random access to
individual array elements in memory, instantly without&nbsp;traversal.</p>
<p>Everything inside a numpy array must be homogenous,
and to be efficient we must know the exact length of the array beforehand.
This is because the task of extending or contracting an array once initialized
requires re-copying all elements into a new array of new length.
We also have to be strict when initializing <code>bools</code> <code>ints</code> and <code>floats</code>
with proper <code>fixed-widths</code> for memory&nbsp;allocation.</p>
<p>In our example we are filling up an array with <code>8-bit bools</code> all set
to <code>True</code>. We then iterate through
an array of factors set to <code>32-bit unsigned integers</code>, and allocate
it&#8217;s multiples as <code>False</code>. Finally, we return all values from the
boolean array from 2 to the end which are still <code>True</code>. However, unlike slicing
python lists which generates a whole new copy from the original, slicing numpy arrays
returns is an in-memory view and is a much cheaper operation. Therefore, the
vector operation <code>primes[i*i::i]</code> is just an in-memory view of the
same <code>primes</code> array requiring no more levels of indirection or
memory allocation to&nbsp;construct.</p>
</div>
</div>
<div class="section" id="testing-for-primality">
<h2>Testing for&nbsp;Primality</h2>
<p>So now that we&#8217;ve written the sieve in a bunch of different ways. How do we know that
each way is&nbsp;correct.</p>
<p>The most obvious way to figure if a number&#8217;s prime, is to try dividing the number
by all the numbers between <mathjax>$2 \leq x \leq n-1$</mathjax>.</p>
<blockquote class="pull-quote">
However, one optimization would be
to only check factors up to <mathjax>$2 \leq x \leq \sqrt{n}$</mathjax>.</blockquote>
<p>This optimization is possible because when computing factors of <mathjax>$n$</mathjax> where
<mathjax>$n = p \times q$</mathjax>, either <mathjax>$p$</mathjax> or <mathjax>$q$</mathjax> must be less than or equal
to <mathjax>$\sqrt{n}$</mathjax> or else their product is greater than <mathjax>$n$</mathjax>.
When moving up values of <mathjax>$p$</mathjax>, we know that for any unique
factor <mathjax>$p$</mathjax> cannot be greater than <mathjax>$q$</mathjax>, therefore computing
up to <mathjax>$p$</mathjax> is sufficient and so we need not proceed&nbsp;further.</p>
<blockquote class="pull-quote">
This optimization reduces the run time for each factorization
down to <mathjax>$\mathcal{O}(\sqrt{n})$</mathjax>.</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="k">def</span> <span class="nf">all_primes</span><span class="p">(</span><span class="n">primes</span><span class="p">:</span> <span class="nb">iter</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="line-2">    <span class="k">for</span> <span class="n">prime</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
</span><span id="line-3">        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">prime</span> <span class="o">%</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">prime</span><span class="o">**</span><span class="mf">0.5</span><span class="p">))):</span>
</span><span id="line-4">            <span class="k">return</span> <span class="bp">False</span>
</span><span id="line-5">    <span class="k">return</span> <span class="bp">True</span>
</span></pre></div>
<blockquote class="pull-quote">
Now lets test to see if our sieves can correctly find the first 100 prime numbers</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">np_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">set_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="n">all_primes</span><span class="p">(</span><span class="n">set_insertion_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
</span><span id="line-2"><span class="bp">True</span>
</span></pre></div>
</div>
<div class="section" id="a-timer">
<h2>A&nbsp;Timer</h2>
<p>Now knowing that our implementations are correct, lets see how fast they run.
We will construct a timer taking advantage of what is known as a <code>context manager</code>.
Basically, a context manager allows us to use the <code>with</code> construct
and will perform an operation before and after by overloading the <code>__enter__</code>
and <code>__exit__</code> methods. We can create a context manager
merely by using a decorator from the <code>contextlib</code> module.</p>
<div class="highlight"><pre><span id="line-1"><span class="kn">import</span> <span class="nn">time</span>
</span><span id="line-2"><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
</span><span id="line-3">
</span><span id="line-4"><span class="nd">@contextmanager</span>
</span><span id="line-5"><span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">label</span><span class="p">):</span>
</span><span id="line-6">    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="line-7">    <span class="k">try</span><span class="p">:</span>
</span><span id="line-8">        <span class="k">yield</span>
</span><span id="line-9">    <span class="k">finally</span><span class="p">:</span>
</span><span id="line-10">        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="line-11">    <span class="k">print</span><span class="p">(</span><span class="s">&#39;{label}: {time:03.3f} sec&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="line-12">        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span>
</span><span id="line-13">    <span class="p">)</span>
</span></pre></div>
<blockquote class="pull-quote">
It&#8217;s also possible to use Python&#8217;s built in <code>timeit</code> module, which can deal
with much more complex and isolated timing instances.</blockquote>
</div>
<div class="section" id="performance-testing">
<h2>Performance&nbsp;Testing</h2>
<blockquote class="pull-quote">
Now lets see how fast our seives can find the first million
digits.</blockquote>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;sieve&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">sieve</span><span class="p">:</span> <span class="mf">0.454</span> <span class="n">sec</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;set_sieve&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">set_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">set_sieve</span><span class="p">:</span> <span class="mf">0.735</span> <span class="n">sec</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;set_insertion_sieve&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">set_insertion_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">set_factor_sieve</span><span class="p">:</span> <span class="mf">0.587</span> <span class="n">sec</span>
</span></pre></div>
<div class="highlight"><pre><span id="line-1"><span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">timer</span><span class="p">(</span><span class="s">&#39;numpy&#39;</span><span class="p">):</span>
</span><span id="line-2">        <span class="n">np_sieve</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">)</span>
</span><span id="line-3">
</span><span id="line-4"><span class="n">numpy</span><span class="p">:</span> <span class="mf">0.008</span> <span class="n">sec</span>
</span></pre></div>
</div>
<script type= "text/javascript">
    if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
        var mathjaxscript = document.createElement('script');
        mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
        mathjaxscript.type = 'text/javascript';
        mathjaxscript.src = 'https:' == document.location.protocol
                ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'
                : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
        mathjaxscript[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" +
            "    config: ['MMLorHTML.js']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    displayAlign: 'center'," +
            "    displayIndent: '0em'," +
            "    showMathMenu: false," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true," +
            "        preview: 'TeX'," +
            "    }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }" +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
    }
</script>

            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'sanghan'; // required: replace example with your forum shortname

                    var disqus_identifier = 'sieve';
                var disqus_url = 'http://sanghan.me/blog/2014/09/sieve/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

    </div>

        <div class="col-sm-3 well well-sm" id="sidebar">

<aside>
    <section>
        <ul class="list-group list-group-flush">
                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
                  <ul class="list-group" id="social">
                    <li class="list-group-item"><a href="http://github.com/jjangsangy"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
                    <li class="list-group-item"><a href="http://facebook.com/jjangsangy"><i class="fa fa-facebook-square fa-lg"></i> Facebook</a></li>
                    <li class="list-group-item"><a href="https://www.linkedin.com/pub/sang-han/40/9a8/323"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
                    <li class="list-group-item"><a href="http://jjangsangy.tumblr.com"><i class="fa fa-tumblr-square fa-lg"></i> Tumblr</a></li>
                    <li class="list-group-item"><a href="http://pinterest.com/jjangsangy"><i class="fa fa-pinterest-square fa-lg"></i> Pinterest</a></li>
                  </ul>
                </li>

                <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                    <ul class="list-group" id="recentposts">
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/09/sieve/">
                                Prime Sieves and Python Data Structures
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/06/swift_program_is_swift_except_when_its_not/">
                                Swift Program is Swift, Except When it's Not
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/06/pelican_blog/">
                                Pelican: A Blogging Engine Written in Python
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/06/swift_bubble_sort/">
                                Swift: Bubble Sort
                            </a>
                        </li>
                        <li class="list-group-item">
                            <a href="http://sanghan.me/blog/2014/05/digital_universe/">
                                Digital Universe
                            </a>
                        </li>
                    </ul>
                </li>



    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/jjangsangy">@jjangsangy</a> on GitHub
    </li>

        </ul>
    </section>

</aside>        </div>
    </div>
</div>

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 LightQuanta
            &middot; Sang Han         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://sanghan.me/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://sanghan.me/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://sanghan.me/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://sanghan.me/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'jjangsangy',
                count: 10,
                skip_forks: true,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://sanghan.me/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sanghan'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-51412306-1']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->
<!-- Custom site js-->
<script src="http://sanghan.me/static/js/site.js"></script>

</body>
</html>